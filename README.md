<!-- markdownlint-disable MD041 -->
[![Open in GitHub Codespaces](https://github.com/codespaces/badge.svg)](https://codespaces.new/chotto2/prime-oasis)

# Prime Oasis - 砂漠の中のオアシスのような素数

素数が連続して現れない区間（以下、素数砂漠と呼ぶ）には、1%前後の確率で素数（以下、オアシス素数と呼ぶ）が存在することがある。

## 概要

これは、「みんなの嫌われ者の素数砂漠で素数を探そう」という、やや捻くれたプロジェクトである。
素数砂漠の99%は、オアシス素数を持たない。
では、なぜ素数砂漠に固執するかと言えば、素数砂漠は一定の間隔で存在し探索に適しているからだ。
例えるなら、狙撃用ライフルでスコープを覗いて素数を狙い撃つ感覚だ。
気になるのは、99%ハズレなのにどのくらいの時間感覚でヒットするかだ。
これを体感できるようにしたので、ぜひ試して欲しい。

## 素数砂漠の位置と大きさ

LCM(1,2,3,...n)は、大きさが2n+1の素数砂漠の中心点を示す。  
※LCM()は最小公倍数を示す。（以下同様）

### 素数を判定する位置

LCM(1,2,3,...n)±1の２点

### 素数砂漠の構造

ここでは素数砂漠として、中心点がLCM(1,2,3,...701)で大きさが1403のものを用意した。
具体的な中心点の値は、下記の通りである。

```text
2626719802592710061239991829174692172528343457131512513976281060940948726537757144360059535978552440933031373189919061646742591656110407680769241480651946904946211000952247368842571964792534944293239882868728171914661797572466549735970311937966946924655356399900939424721115438589874540587436119564591680000
```

この値を素因数分解して積算の形式で示すと下記の様になる。

```text
2^9*3^5*5^4*7^3*11^2*13^2*17^2*19^2*23^2*29^1*31^1*37^1*...677^1*683^1*691^1*701^1
```

ここで積算式の末尾に注目して欲しい。  
これは原点０からLCM(1,2,3,...701)までには、LCM(1,2,3,...691)の倍数を中心点とする素数砂漠が701個あることを示す。  
同様に原点０からLCM(1,2,3,...691)までには、LCM(1,2,3,...683)の倍数を中心点とする素数砂漠が691個あることを示す。  
同様に原点０からLCM(1,2,3,...683)までには、LCM(1,2,3,...677)の倍数を中心点とする素数砂漠が683個あることを示す。  
同様に...（続く）

このように1つの素数砂漠を見れば、それ以下の素数砂漠がマトリョシカの様な階層構造になっていることが分かる。  
マトリョシカは1つの人形を開けると少し小さい人形が1つ現れるだけだが、素数砂漠の場合は複数である。  
これは原点０からLCM(1,2,3,...701)までには、LCM(1,2,3,...683)の倍数を中心点とする素数砂漠が`701*691=484391`個あることを示す。  
同様に原点０からLCM(1,2,3,...701)までには、LCM(1,2,3,...677)の倍数を中心点とする素数砂漠が`701*691*683=330839053`個あることを示す。  
大小の素数砂漠の中心点が一致する箇所は、重ね合わせの状態となり大きさが大きい方の素数砂漠のサイズとなる。
もっとも本方式では、素数砂漠の大きさはまったくもって問題としていない。

### プログラム構造

プログラムは、main()関数、make_lcm()マクロとfind_prime_oasis()関数で構成している。

main()関数は、探索の開始位置(start)と終了位置(end)と粒度(step)を指定している。  
start,end,stepとも全て素数砂漠の中心点で指定している。
ここで注意して欲しいのは、startを原点0ではなくLCM(1,2,3,...701)にしていることである。  
通常、整数ｎの倍数を途中位置ｍから探索する場合、除算して積算して位置調整する必要がある。  
startをLCM(1,2,3,...701)にすると、1から701の全ての倍数が原点０から探索するのと等価となり位置調整が不要となる。  
それに加えて出力結果のビット数を平準化することができる。  
endは`start*2`とした。原点０からLCM(1,2,3,...701)の探索と同じサイズ感となり分かりやすいと判断したからだ。  
stepは層という概念を導入して下記のようにした。  

- **第1層**: LCM(1,2,3,...691)   // oasis_layer1コマンドのstep
- **第2層**: LCM(1,2,3,...683)   // oasis_layer2コマンドのstep
- **第3層**: LCM(1,2,3,...677)   // oasis_layer3コマンドのstep

ここで第1層は粒度が最も荒く高速で、第3層は最も粒度が細かく低速となる。  
第1層の内容は全て第2層に重ね合わせの形で含まれる。  

make_lcm(A, B)マクロは、LCM(1,2,3,...B)の値を計算しmpz_t型のAに代入する。

find_prime_oasis()関数は、startからendまでの区間をstep刻みで素数砂漠のオアシス素数を探す。  
start,end,stepはすべてmpz_t型の変数でLCM(1,2,3,...n)形式の値を指定する。

## プログラム構成

プログラムは下記の5本で構成している。

- **oasis_layer1**: 第1層のフルスペック版
- **oasis_layer2**: 第2層のフルスペック版
- **oasis_layer3**: 第3層のマイナーチェンジ版（Codespaceで11分程度で終了するように調整済み）
- **oasis_divs**: LCM(1,2,3,...n)形式の素因数分解の情報を2から順次表示
- **prime_oasis**: コマンドライン引数でstart/end/stepを指定可能な汎用版（v1.5.0で追加）
  - 引数の数と値をチェックし、不正な場合はUSAGEを表示
  - 2つまたは3つの引数を受け付ける
  - 引数は全てnの値（LCM(1,2,3,...n)のn）で指定

## 特徴

- 🎯 **非消去法アプローチ** - 消去ではなく積極的に素数候補の領域を絞り込む
- 🔢 **LCM法** - 最小公倍数を利用した革新的アルゴリズム
- 🏜️ **素数砂漠内の探索** - 大きな素数砂漠内の素数を効率的に発見
- 🐳 **Docker対応** - 再現可能なビルド環境
- 📊 **約1024ビット** - 教育・研究目的に適したサイズ

## 必要環境

- Docker Desktop
- Git

## ビルドと実行

```bash
# リポジトリのクローン
git clone https://github.com/chotto2/prime-oasis.git
cd prime-oasis

# Dockerイメージのビルド
docker build -t prime-oasis .

# 各レイヤーの実行
docker run -it prime-oasis /app/build/oasis_layer1
docker run -it prime-oasis /app/build/oasis_layer2
docker run -it prime-oasis /app/build/oasis_layer3
docker run -it prime-oasis /app/build/oasis_divs

# prime_oasisコマンドの実行
# 使用方法: prime_oasis <start> [<end>] <step>
#   - 2引数の場合: prime_oasis <start> <step>（endはstart*2と同じ値になる）
#   - 3引数の場合: prime_oasis <start> <end> <step>

# 例1: oasis_layer2と同等（start=701, end=701*2, step=683）
docker run -it prime-oasis /app/build/prime_oasis 701 683

# 例2: start/end/stepを明示的に指定
docker run -it prime-oasis /app/build/prime_oasis 701 709 683

# 例3: USAGEメッセージの表示（不正な引数の場合）
docker run -it prime-oasis /app/build/prime_oasis
```

## パフォーマンス

```text
oasis_layer1: (try=1402, hit=20, twin=0)
real    0m0.824s
user    0m0.016s
sys     0m0.013s

oasis_layer2: (try=968782, hit=16093, twin=143)
real    5m59.044s
user    0m0.431s
sys     0m0.721s

oasis_layer3: (try=1928792, hit=32000, twin=282)
real    11m54.582s
user    0m0.962s
sys     0m1.621s

oasis_divs: lcm(1,2,3,...n) // n=2-1429
real    0m17.802s
user    0m0.016s
sys     0m0.038s

prime_oasis 701 683: (try=968782, hit=16093, twin=143)  // equivalent to oasis_layer2
real    5m58.662s
user    0m0.433s
sys     0m0.770s
```

※Codespace:2-Core  
※出力のリダイレクトなし

## 出力例

```text
Prime Oasis Layer 2 - Press 'q', ESC, or Ctrl+C to interrupt
=============================================================

oasis prime  = 2627072279800520541108487733245775976709705914990377662819691566645970417005220318148142724703856185033686932519587335291395440838811257152578688808732448765114590478925747900600954691097754312058906587230259388083365289208029989861267516201208765727131254172910746710700018581925544158406797303706682880001
oasis prime  = 2627164466147178666612555892772059433187908403968850086363352775830360705281326071292718327908935625798473771113500576090766186009671479322128851956076580020850935880857278808906993250285273223628388648370967552312103125481946581894037554239287395260086488975082542462417577865567180827682630228789999039999
...
oasis prime  = 2628943120365053088102812147161528475826168191318200375911639635388008620255601779023353495630468365260243362807826633866860563423915765887567293857775112484469835400477404569164678392256226340968983710379925073901868437119866710526306523444569188601811019275808954613203427573476405976063406665691628479999
oasis primes = 2628943120365053088102812147161528475826168191318200375911639635388008620255601779023353495630468365260243362807826633866860563423915765887567293857775112484469835400477404569164678392256226340968983710379925073901868437119866710526306523444569188601811019275808954613203427573476405976063406665691628480001
...
oasis prime  = 5253325727933665967445546520111034192936554427877853210633921804654121214616795417188584503292006749156620181057945296423674262807040540916800046132231731670453407093636133027424743356471075939000648984328346258605588620924212603431459988652424998543895422750060248803202892938563609666187078625790969279999
oasis prime  = 5253336573386213982210731009467067540757519426581202907521411358675814189708101976382063986022016095128948044421935089458894350474200567054394182973095747112304741846804548428401924363434313458008823344462547219103087189897614555435315287245140131430125450373845165950463782266050861039043058969918418239999
(try=968782, hit=16093, twin=143)
```

最初の行は、oasis_layer2が実行中でｑかESCかCtrl-Cの押下で処理を中断できることを示している。  

セパレータに続きヒットしたオアシス素数が表示される。  

先頭のブロックと末尾のブロックは、１つの素数砂漠で１つだけ発見されたオアシス素数のリストを表示している。  

真ん中のブロックは双子素数がヒットしたことを示している。  
双子素数の２つめの素数はoasis primesというキーワードで表示される。  
双子素数の１つめの素数はoasis primeというキーワードで直前に表示される。  

最後の行は、統計情報を括弧でくくって表示する。  
tryは、素数かどうか調べた回数を示す。  
hitは、素数を見つけた回数を示す。  
twinは、双子素数を見つけた回数を示す。  

## 技術詳細

- **言語**: C
- **ライブラリ**: GMP (GNU Multiple Precision Arithmetic Library)
- **ビルドシステム**: CMake
- **LCM範囲**: 1..701 (約1020ビット)

## 注意事項

⚠️ **重要**: このバージョンは教育・研究目的の実装です。約1024ビットの素数を扱うため、現代の暗号システム（RSA-4096など）には影響しません。

## 今後の予定

- 📝 arXivへの論文投稿予定
- 📚 アルゴリズムの詳細な理論的背景

## ライセンス

MIT License

## 著者

N.Arai

## 引用

論文準備中。公開後、適切な引用方法を記載します。

## 関連リンク

- 論文: arXiv (準備中)
- リポジトリ: [https://github.com/chotto2/prime-oasis][def]

[def]: https://github.com/chotto2/prime-oasis
